<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/Controllers/ChatbotController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/Controllers/ChatbotController.java" />
              <option name="originalContent" value="package Controllers;&#10;&#10;import Api.AiChatService;&#10;import Api.TacheApiService;&#10;import javafx.application.Platform;&#10;import javafx.fxml.FXML;&#10;import javafx.scene.control.Label;&#10;import javafx.scene.control.ScrollPane;&#10;import javafx.scene.control.TextArea;&#10;import javafx.scene.layout.HBox;&#10;import javafx.scene.layout.Priority;&#10;import javafx.scene.layout.Region;&#10;import javafx.scene.layout.VBox;&#10;&#10;import java.util.concurrent.CompletableFuture;&#10;&#10;public class ChatbotController {&#10;&#10;    @FXML&#10;    private VBox messagesContainer;&#10;&#10;    @FXML&#10;    private TextArea inputField;&#10;&#10;    @FXML&#10;    private ScrollPane scrollPane;&#10;&#10;    /** Historique complet pour des réponses longues type ChatGPT. */&#10;    private final StringBuilder conversationHistory = new StringBuilder();&#10;&#10;    @FXML&#10;    public void initialize() {&#10;        if (scrollPane != null &amp;&amp; messagesContainer != null) {&#10;            scrollPane.vvalueProperty().bind(messagesContainer.heightProperty());&#10;        }&#10;        // Charger automatiquement une citation Quotable au démarrage&#10;        loadRandomQuote();&#10;    }&#10;&#10;    @FXML&#10;    public void handleSend() {&#10;        String text = inputField.getText();&#10;        if (text == null || text.trim().isEmpty()) {&#10;            return;&#10;        }&#10;&#10;        String cleaned = text.trim();&#10;        addUserMessage(cleaned);&#10;        inputField.clear();&#10;&#10;        // Ajouter au contexte de conversation&#10;        conversationHistory.append(&quot;Utilisateur : &quot;).append(cleaned).append(&quot;\n&quot;);&#10;&#10;        // Ajouter un label de bot vide (nous allons le remplir en streaming)&#10;        final Label botLabel = addBotMessage(&quot;L’assistant AGRIGO prépare une réponse...&quot;);&#10;&#10;        // Appel streaming (OpenAI) ; si pas de clé, la méthode complète avec null -&gt; fallback&#10;        CompletableFuture&lt;String&gt; fut = AiChatService.askAgrigoAssistantStream(conversationHistory.toString(), delta -&gt; {&#10;            // delta fragments peuvent arriver depuis un thread non-JavaFX&#10;            Platform.runLater(() -&gt; {&#10;                // remplacer le texte d'attente par la première partie&#10;                String cur = botLabel.getText();&#10;                if (cur != null &amp;&amp; cur.startsWith(&quot;L’assistant AGRIGO prépare&quot;)) {&#10;                    botLabel.setText(&quot;&quot;);&#10;                }&#10;                // Append le delta&#10;                botLabel.setText(botLabel.getText() + delta);&#10;            });&#10;        });&#10;&#10;        fut.thenAccept(reply -&gt; Platform.runLater(() -&gt; {&#10;            // Si l'API n'a pas répondu (null) -&gt; utiliser le fallback local&#10;            if (reply == null || reply.trim().isEmpty()) {&#10;                String finalReply = buildReply(cleaned.toLowerCase());&#10;                botLabel.setText(finalReply);&#10;                conversationHistory.append(&quot;Assistant : &quot;).append(finalReply).append(&quot;\n&quot;);&#10;            } else {&#10;                // reply contient la version finale ; si le streaming a déjà rempli le label, on peut garder&#10;                botLabel.setText(reply.trim());&#10;                conversationHistory.append(&quot;Assistant : &quot;).append(reply.trim()).append(&quot;\n&quot;);&#10;            }&#10;        }));&#10;    }&#10;&#10;    private void loadRandomQuote() {&#10;        TacheApiService.getRandomQuote().thenAccept(result -&gt; {&#10;            Platform.runLater(() -&gt; {&#10;                if (result == null || result.content == null || result.content.isEmpty()) {&#10;                    addBotMessage(&quot; Astuce AGRIGO : pensez à enregistrer vos tâches et interventions dès qu’elles sont planifiées, cela évite les oublis sur le terrain.&quot;);&#10;                } else {&#10;                    String author = (result.author != null &amp;&amp; !result.author.isEmpty())&#10;                            ? &quot; — &quot; + result.author&#10;                            : &quot;&quot;;&#10;                    addBotMessage(&quot; Citation du jour :\n\&quot;&quot; + result.content + &quot;\&quot;&quot; + author);&#10;                }&#10;            });&#10;        });&#10;    }&#10;&#10;    private String buildReply(String question) {&#10;        // Problèmes techniques / erreurs&#10;        if (question.contains(&quot;erreur&quot;) || question.contains(&quot;bug&quot;) || question.contains(&quot;ne marche pas&quot;)) {&#10;            return &quot;D’accord, vous rencontrez un problème technique.\n\n&quot; +&#10;                    &quot;1) Dites-moi sur quel écran AGRIGO vous êtes (connexion, tâches, tableau de bord, etc.).\n&quot; +&#10;                    &quot;2) Copiez le message d’erreur exact ou décrivez ce qui se bloque.\n&quot; +&#10;                    &quot;3) Précisez ce que vous vouliez faire (par ex. ajouter une tâche, modifier un utilisateur…).\n\n&quot; +&#10;                    &quot;Avec ces infos, un agent pourra reproduire et corriger le problème rapidement.&quot;;&#10;        }&#10;&#10;        // Tâches / main d’œuvre&#10;        if (question.contains(&quot;tache&quot;) || question.contains(&quot;tâche&quot;)&#10;                || question.contains(&quot;main d’œuvre&quot;) || question.contains(&quot;main oeuvre&quot;)&#10;                || question.contains(&quot;ouvrier&quot;) || question.contains(&quot;ouvriers&quot;)) {&#10;            return &quot;Module tâches / main d’œuvre :\n\n&quot; +&#10;                    &quot;• Pour voir les tâches : allez dans « Gestion Tâches » puis filtrez par statut ou par ouvrier.\n&quot; +&#10;                    &quot;• Pour ajouter une tâche : bouton « Ajouter », remplissez la parcelle, la date, l’ouvrier et la description.\n&quot; +&#10;                    &quot;• Pour modifier : sélectionnez la tâche dans la liste puis cliquez sur « Modifier ».\n\n&quot; +&#10;                    &quot;Dites-moi ce que vous voulez faire précisément (ex : créer une nouvelle tâche pour un ouvrier) et je vous détaille les étapes.&quot;;&#10;        }&#10;&#10;        // Parcelles / cultures&#10;        if (question.contains(&quot;parcelle&quot;) || question.contains(&quot;champ&quot;)&#10;                || question.contains(&quot;culture&quot;) || question.contains(&quot;cultures&quot;)) {&#10;            return &quot;Gestion des parcelles / cultures :\n\n&quot; +&#10;                    &quot;• Chaque parcelle regroupe une culture, une surface et, si besoin, un planning d’intervention.\n&quot; +&#10;                    &quot;• Les tâches et l’irrigation peuvent ensuite être reliées à une parcelle.\n\n&quot; +&#10;                    &quot;Dites-moi si vous voulez :\n&quot; +&#10;                    &quot;1) Créer une nouvelle parcelle\n&quot; +&#10;                    &quot;2) Consulter les interventions d’une parcelle\n&quot; +&#10;                    &quot;3) Lier des tâches ou de l’irrigation à une parcelle.&quot;;&#10;        }&#10;&#10;        // Irrigation intelligente&#10;        if (question.contains(&quot;irrigation&quot;) || question.contains(&quot;arrosage&quot;)&#10;                || question.contains(&quot;eau&quot;) || question.contains(&quot;humidit&quot;)) {&#10;            return &quot;Module irrigation intelligente :\n\n&quot; +&#10;                    &quot;• L’objectif est d’optimiser l’eau selon la culture et l’humidité du sol.\n\n&quot; +&#10;                    &quot;• En général, on configure : la parcelle, le type de culture, les horaires d’arrosage et les seuils (humidité / météo).\n\n&quot; +&#10;                    &quot;Indiquez-moi si vous voulez :\n&quot; +&#10;                    &quot;- Configurer une nouvelle règle d’irrigation\n&quot; +&#10;                    &quot;- Comprendre un indicateur (par ex. humidité, volume d’eau)\n&quot; +&#10;                    &quot;- Résoudre un problème d’arrosage qui ne se lance pas.&quot;;&#10;        }&#10;&#10;        // Stocks agricoles&#10;        if (question.contains(&quot;stock&quot;) || question.contains(&quot;engrais&quot;)&#10;                || question.contains(&quot;semence&quot;) || question.contains(&quot;semis&quot;)&#10;                || question.contains(&quot;intrant&quot;) || question.contains(&quot;intrants&quot;)) {&#10;            return &quot;Module stocks agricoles :\n\n&quot; +&#10;                    &quot;• Vous pouvez enregistrer vos intrants (engrais, semences, produits) avec quantités et alertes de seuil.\n&quot; +&#10;                    &quot;• À chaque utilisation, le stock est mis à jour pour suivre les entrées/sorties.\n\n&quot; +&#10;                    &quot;Précisez si vous voulez :\n&quot; +&#10;                    &quot;- Ajouter un nouveau produit au stock\n&quot; +&#10;                    &quot;- Mettre à jour une quantité\n&quot; +&#10;                    &quot;- Comprendre un indicateur ou une alerte de stock.&quot;;&#10;        }&#10;&#10;        // Ventes / récoltes&#10;        if (question.contains(&quot;vente&quot;) || question.contains(&quot;vendre&quot;)&#10;                || question.contains(&quot;récolte&quot;) || question.contains(&quot;recolte&quot;)&#10;                || question.contains(&quot;production&quot;)) {&#10;            return &quot;Module ventes / récoltes :\n\n&quot; +&#10;                    &quot;• Enregistrez vos récoltes (culture, quantité, date, parcelle) puis les ventes associées.\n\n&quot; +&#10;                    &quot;• Les tableaux de bord vous montrent les volumes et revenus par culture ou période.\n\n&quot; +&#10;                    &quot;Dites-moi si vous voulez :\n&quot; +&#10;                    &quot;- Enregistrer une nouvelle récolte\n&quot; +&#10;                    &quot;- Ajouter une vente\n&quot; +&#10;                    &quot;- Lire un indicateur de performance (revenu, rendement).&quot;;&#10;        }&#10;&#10;        // Connexion / compte&#10;        if (question.contains(&quot;connexion&quot;) || question.contains(&quot;connecter&quot;)&#10;                || question.contains(&quot;mot de passe&quot;) || question.contains(&quot;login&quot;)) {&#10;            return &quot;Compte / connexion AGRIGO :\n\n&quot; +&#10;                    &quot;• Vérifiez votre email et mot de passe sur l’écran de connexion.\n&quot; +&#10;                    &quot;• En cas d’oubli, utilisez le lien « Mot de passe oublié ? » si disponible ou contactez l’administrateur.\n\n&quot; +&#10;                    &quot;Expliquez-moi si vous :\n&quot; +&#10;                    &quot;- Avez une erreur précise à la connexion\n&quot; +&#10;                    &quot;- Avez perdu l’accès à votre compte\n&quot; +&#10;                    &quot;- Voulez modifier vos informations (email, téléphone, rôle, photo).&quot;;&#10;        }&#10;&#10;        // Réponse par défaut&#10;        return &quot;Merci pour votre message.\n\n&quot; +&#10;                &quot;Je suis l’assistant AGRIGO intégré. Pour bien vous aider :\n&quot; +&#10;                &quot;1) Dites-moi sur quel module vous travaillez (tâches, parcelles, irrigation, stocks, ventes…).\n&quot; +&#10;                &quot;2) Décrivez ce que vous essayez de faire.\n&quot; +&#10;                &quot;3) S’il y a une erreur, copiez-la ici.\n\n&quot; +&#10;                &quot;Je vous proposerai ensuite des étapes simples adaptées à votre cas, et pour les situations complexes un agent humain pourra prendre le relais.&quot;;&#10;    }&#10;&#10;    private void addUserMessage(String message) {&#10;        Label label = new Label(message);&#10;        label.setWrapText(true);&#10;        label.setStyle(&quot;-fx-background-color: #22c55e; &quot; +&#10;                &quot;-fx-background-radius: 10; &quot; +&#10;                &quot;-fx-padding: 8 10 8 10; &quot; +&#10;                &quot;-fx-text-fill: white; &quot; +&#10;                &quot;-fx-font-size: 12px;&quot;);&#10;&#10;        HBox container = new HBox();&#10;        Region spacer = new Region();&#10;        HBox.setHgrow(spacer, Priority.ALWAYS);&#10;        container.getChildren().addAll(spacer, label);&#10;        container.setSpacing(6);&#10;&#10;        messagesContainer.getChildren().add(container);&#10;    }&#10;&#10;    private Label addBotMessage(String message) {&#10;        Label label = new Label(message);&#10;        label.setWrapText(true);&#10;        label.setStyle(&quot;-fx-background-color: white; &quot; +&#10;                &quot;-fx-background-radius: 10; &quot; +&#10;                &quot;-fx-padding: 8 10 8 10; &quot; +&#10;                &quot;-fx-text-fill: #111827; &quot; +&#10;                &quot;-fx-font-size: 12px; &quot; +&#10;                &quot;-fx-effect: dropshadow(gaussian, rgba(0,0,0,0.04), 6, 0, 0, 1);&quot;);&#10;&#10;        HBox container = new HBox(label);&#10;        container.setSpacing(6);&#10;&#10;        messagesContainer.getChildren().add(container);&#10;        return label;&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package Controllers;&#10;&#10;import Api.AiChatService;&#10;import Api.TacheApiService;&#10;import javafx.application.Platform;&#10;import javafx.fxml.FXML;&#10;import javafx.scene.control.Label;&#10;import javafx.scene.control.ScrollPane;&#10;import javafx.scene.control.TextArea;&#10;import javafx.scene.layout.HBox;&#10;import javafx.scene.layout.Priority;&#10;import javafx.scene.layout.Region;&#10;import javafx.scene.layout.VBox;&#10;&#10;import java.util.concurrent.CompletableFuture;&#10;&#10;public class ChatbotController {&#10;&#10;    @FXML&#10;    private VBox messagesContainer;&#10;&#10;    @FXML&#10;    private TextArea inputField;&#10;&#10;    @FXML&#10;    private ScrollPane scrollPane;&#10;&#10;    /** Historique complet pour des réponses longues type ChatGPT. */&#10;    private final StringBuilder conversationHistory = new StringBuilder();&#10;&#10;    @FXML&#10;    public void initialize() {&#10;        if (scrollPane != null &amp;&amp; messagesContainer != null) {&#10;            scrollPane.vvalueProperty().bind(messagesContainer.heightProperty());&#10;        }&#10;        if (messagesContainer != null) messagesContainer.getStyleClass().add(&quot;messages-container&quot;);&#10;&#10;        // Charger dynamiquement la feuille de styles quand la scene est prête&#10;        Platform.runLater(() -&gt; {&#10;            try {&#10;                if (messagesContainer != null &amp;&amp; messagesContainer.getScene() != null) {&#10;                    String css = getClass().getResource(&quot;/css/chatbot.css&quot;).toExternalForm();&#10;                    messagesContainer.getScene().getStylesheets().add(css);&#10;                }&#10;            } catch (Exception ignored) {}&#10;        });&#10;&#10;        // Charger automatiquement une citation Quotable au démarrage&#10;        loadRandomQuote();&#10;    }&#10;&#10;    @FXML&#10;    public void handleSend() {&#10;        String text = inputField.getText();&#10;        if (text == null || text.trim().isEmpty()) {&#10;            return;&#10;        }&#10;&#10;        String cleaned = text.trim();&#10;        addUserMessage(cleaned);&#10;        inputField.clear();&#10;&#10;        // Ajouter au contexte de conversation&#10;        conversationHistory.append(&quot;Utilisateur : &quot;).append(cleaned).append(&quot;\n&quot;);&#10;&#10;        // Ajouter un label de bot vide (nous allons le remplir en streaming)&#10;        final Label botLabel = addBotMessage(&quot;L’assistant AGRIGO prépare une réponse...&quot;);&#10;&#10;        // Appel streaming (OpenAI) ; si pas de clé, la méthode complète avec null -&gt; fallback&#10;        CompletableFuture&lt;String&gt; fut = AiChatService.askAgrigoAssistantStream(conversationHistory.toString(), delta -&gt; {&#10;            // delta fragments peuvent arriver depuis un thread non-JavaFX&#10;            Platform.runLater(() -&gt; {&#10;                // remplacer le texte d'attente par la première partie&#10;                String cur = botLabel.getText();&#10;                if (cur != null &amp;&amp; cur.startsWith(&quot;L’assistant AGRIGO prépare&quot;)) {&#10;                    botLabel.setText(&quot;&quot;);&#10;                }&#10;                // Append le delta&#10;                botLabel.setText(botLabel.getText() + delta);&#10;            });&#10;        });&#10;&#10;        fut.thenAccept(reply -&gt; Platform.runLater(() -&gt; {&#10;            // Si l'API n'a pas répondu (null) -&gt; utiliser le fallback local&#10;            if (reply == null || reply.trim().isEmpty()) {&#10;                String finalReply = buildReply(cleaned.toLowerCase());&#10;                botLabel.setText(finalReply);&#10;                conversationHistory.append(&quot;Assistant : &quot;).append(finalReply).append(&quot;\n&quot;);&#10;            } else {&#10;                // reply contient la version finale ; si le streaming a déjà rempli le label, on peut garder&#10;                botLabel.setText(reply.trim());&#10;                conversationHistory.append(&quot;Assistant : &quot;).append(reply.trim()).append(&quot;\n&quot;);&#10;            }&#10;        }));&#10;    }&#10;&#10;    private void loadRandomQuote() {&#10;        TacheApiService.getRandomQuote().thenAccept(result -&gt; {&#10;            Platform.runLater(() -&gt; {&#10;                if (result == null || result.content == null || result.content.isEmpty()) {&#10;                    addBotMessage(&quot; Astuce AGRIGO : pensez à enregistrer vos tâches et interventions dès qu’elles sont planifiées, cela évite les oublis sur le terrain.&quot;);&#10;                } else {&#10;                    String author = (result.author != null &amp;&amp; !result.author.isEmpty())&#10;                            ? &quot; — &quot; + result.author&#10;                            : &quot;&quot;;&#10;                    addBotMessage(&quot; Citation du jour :\n\&quot;&quot; + result.content + &quot;\&quot;&quot; + author);&#10;                }&#10;            });&#10;        });&#10;    }&#10;&#10;    private String buildReply(String question) {&#10;        // Problèmes techniques / erreurs&#10;        if (question.contains(&quot;erreur&quot;) || question.contains(&quot;bug&quot;) || question.contains(&quot;ne marche pas&quot;)) {&#10;            return &quot;D’accord, vous rencontrez un problème technique.\n\n&quot; +&#10;                    &quot;1) Dites-moi sur quel écran AGRIGO vous êtes (connexion, tâches, tableau de bord, etc.).\n&quot; +&#10;                    &quot;2) Copiez le message d’erreur exact ou décrivez ce qui se bloque.\n&quot; +&#10;                    &quot;3) Précisez ce que vous vouliez faire (par ex. ajouter une tâche, modifier un utilisateur…).\n\n&quot; +&#10;                    &quot;Avec ces infos, un agent pourra reproduire et corriger le problème rapidement.&quot;;&#10;        }&#10;&#10;        // Tâches / main d’œuvre&#10;        if (question.contains(&quot;tache&quot;) || question.contains(&quot;tâche&quot;)&#10;                || question.contains(&quot;main d’œuvre&quot;) || question.contains(&quot;main oeuvre&quot;)&#10;                || question.contains(&quot;ouvrier&quot;) || question.contains(&quot;ouvriers&quot;)) {&#10;            return &quot;Module tâches / main d’œuvre :\n\n&quot; +&#10;                    &quot;• Pour voir les tâches : allez dans « Gestion Tâches » puis filtrez par statut ou par ouvrier.\n&quot; +&#10;                    &quot;• Pour ajouter une tâche : bouton « Ajouter », remplissez la parcelle, la date, l’ouvrier et la description.\n&quot; +&#10;                    &quot;• Pour modifier : sélectionnez la tâche dans la liste puis cliquez sur « Modifier ».\n\n&quot; +&#10;                    &quot;Dites-moi ce que vous voulez faire précisément (ex : créer une nouvelle tâche pour un ouvrier) et je vous détaille les étapes.&quot;;&#10;        }&#10;&#10;        // Parcelles / cultures&#10;        if (question.contains(&quot;parcelle&quot;) || question.contains(&quot;champ&quot;)&#10;                || question.contains(&quot;culture&quot;) || question.contains(&quot;cultures&quot;)) {&#10;            return &quot;Gestion des parcelles / cultures :\n\n&quot; +&#10;                    &quot;• Chaque parcelle regroupe une culture, une surface et, si besoin, un planning d’intervention.\n&quot; +&#10;                    &quot;• Les tâches et l’irrigation peuvent ensuite être reliées à une parcelle.\n\n&quot; +&#10;                    &quot;Dites-moi si vous voulez :\n&quot; +&#10;                    &quot;1) Créer une nouvelle parcelle\n&quot; +&#10;                    &quot;2) Consulter les interventions d’une parcelle\n&quot; +&#10;                    &quot;3) Lier des tâches ou de l’irrigation à une parcelle.&quot;;&#10;        }&#10;&#10;        // Irrigation intelligente&#10;        if (question.contains(&quot;irrigation&quot;) || question.contains(&quot;arrosage&quot;)&#10;                || question.contains(&quot;eau&quot;) || question.contains(&quot;humidit&quot;)) {&#10;            return &quot;Module irrigation intelligente :\n\n&quot; +&#10;                    &quot;• L’objectif est d’optimiser l’eau selon la culture et l’humidité du sol.\n\n&quot; +&#10;                    &quot;• En général, on configure : la parcelle, le type de culture, les horaires d’arrosage et les seuils (humidité / météo).\n\n&quot; +&#10;                    &quot;Indiquez-moi si vous voulez :\n&quot; +&#10;                    &quot;- Configurer une nouvelle règle d’irrigation\n&quot; +&#10;                    &quot;- Comprendre un indicateur (par ex. humidité, volume d’eau)\n&quot; +&#10;                    &quot;- Résoudre un problème d’arrosage qui ne se lance pas.&quot;;&#10;        }&#10;&#10;        // Stocks agricoles&#10;        if (question.contains(&quot;stock&quot;) || question.contains(&quot;engrais&quot;)&#10;                || question.contains(&quot;semence&quot;) || question.contains(&quot;semis&quot;)&#10;                || question.contains(&quot;intrant&quot;) || question.contains(&quot;intrants&quot;)) {&#10;            return &quot;Module stocks agricoles :\n\n&quot; +&#10;                    &quot;• Vous pouvez enregistrer vos intrants (engrais, semences, produits) avec quantités et alertes de seuil.\n&quot; +&#10;                    &quot;• À chaque utilisation, le stock est mis à jour pour suivre les entrées/sorties.\n\n&quot; +&#10;                    &quot;Précisez si vous voulez :\n&quot; +&#10;                    &quot;- Ajouter un nouveau produit au stock\n&quot; +&#10;                    &quot;- Mettre à jour une quantité\n&quot; +&#10;                    &quot;- Comprendre un indicateur ou une alerte de stock.&quot;;&#10;        }&#10;&#10;        // Ventes / récoltes&#10;        if (question.contains(&quot;vente&quot;) || question.contains(&quot;vendre&quot;)&#10;                || question.contains(&quot;récolte&quot;) || question.contains(&quot;recolte&quot;)&#10;                || question.contains(&quot;production&quot;)) {&#10;            return &quot;Module ventes / récoltes :\n\n&quot; +&#10;                    &quot;• Enregistrez vos récoltes (culture, quantité, date, parcelle) puis les ventes associées.\n\n&quot; +&#10;                    &quot;• Les tableaux de bord vous montrent les volumes et revenus par culture ou période.\n\n&quot; +&#10;                    &quot;Dites-moi si vous voulez :\n&quot; +&#10;                    &quot;- Enregistrer une nouvelle récolte\n&quot; +&#10;                    &quot;- Ajouter une vente\n&quot; +&#10;                    &quot;- Lire un indicateur de performance (revenu, rendement).&quot;;&#10;        }&#10;&#10;        // Connexion / compte&#10;        if (question.contains(&quot;connexion&quot;) || question.contains(&quot;connecter&quot;)&#10;                || question.contains(&quot;mot de passe&quot;) || question.contains(&quot;login&quot;)) {&#10;            return &quot;Compte / connexion AGRIGO :\n\n&quot; +&#10;                    &quot;• Vérifiez votre email et mot de passe sur l’écran de connexion.\n&quot; +&#10;                    &quot;• En cas d’oubli, utilisez le lien « Mot de passe oublié ? » si disponible ou contactez l’administrateur.\n\n&quot; +&#10;                    &quot;Expliquez-moi si vous :\n&quot; +&#10;                    &quot;- Avez une erreur précise à la connexion\n&quot; +&#10;                    &quot;- Avez perdu l’accès à votre compte\n&quot; +&#10;                    &quot;- Voulez modifier vos informations (email, téléphone, rôle, photo).&quot;;&#10;        }&#10;&#10;        // Réponse par défaut&#10;        return &quot;Merci pour votre message.\n\n&quot; +&#10;                &quot;Je suis l’assistant AGRIGO intégré. Pour bien vous aider :\n&quot; +&#10;                &quot;1) Dites-moi sur quel module vous travaillez (tâches, parcelles, irrigation, stocks, ventes…).\n&quot; +&#10;                &quot;2) Décrivez ce que vous essayez de faire.\n&quot; +&#10;                &quot;3) S’il y a une erreur, copiez-la ici.\n\n&quot; +&#10;                &quot;Je vous proposerai ensuite des étapes simples adaptées à votre cas, et pour les situations complexes un agent humain pourra prendre le relais.&quot;;&#10;    }&#10;&#10;    private void addUserMessage(String message) {&#10;        Label msg = new Label(message);&#10;        msg.setWrapText(true);&#10;        msg.getStyleClass().addAll(&quot;message&quot;, &quot;user&quot;);&#10;&#10;        Label avatar = new Label(&quot;&quot;);&#10;        avatar.getStyleClass().addAll(&quot;avatar&quot;, &quot;user&quot;);&#10;&#10;        HBox container = new HBox();&#10;        container.getChildren().addAll(avatar, msg);&#10;        container.getStyleClass().add(&quot;hbox-user&quot;);&#10;        HBox.setHgrow(msg, Priority.ALWAYS);&#10;&#10;        messagesContainer.getChildren().add(container);&#10;    }&#10;&#10;    private Label addBotMessage(String message) {&#10;        Label msg = new Label(message);&#10;        msg.setWrapText(true);&#10;        msg.getStyleClass().addAll(&quot;message&quot;, &quot;bot&quot;);&#10;&#10;        Label avatar = new Label(&quot;&quot;);&#10;        avatar.getStyleClass().addAll(&quot;avatar&quot;, &quot;bot&quot;);&#10;&#10;        HBox container = new HBox();&#10;        container.getChildren().addAll(avatar, msg);&#10;        container.getStyleClass().add(&quot;hbox-bot&quot;);&#10;        HBox.setHgrow(msg, Priority.ALWAYS);&#10;&#10;        messagesContainer.getChildren().add(container);&#10;        return msg;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/resources/Chatbot.fxml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/resources/Chatbot.fxml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&#10;&lt;?import javafx.geometry.Insets?&gt;&#10;&lt;?import javafx.scene.control.Button?&gt;&#10;&lt;?import javafx.scene.control.Label?&gt;&#10;&lt;?import javafx.scene.control.ScrollPane?&gt;&#10;&lt;?import javafx.scene.control.TextArea?&gt;&#10;&lt;?import javafx.scene.layout.BorderPane?&gt;&#10;&lt;?import javafx.scene.layout.HBox?&gt;&#10;&lt;?import javafx.scene.layout.Priority?&gt;&#10;&lt;?import javafx.scene.layout.Region?&gt;&#10;&lt;?import javafx.scene.layout.VBox?&gt;&#10;&#10;&lt;BorderPane xmlns=&quot;http://javafx.com/javafx/21&quot;&#10;            xmlns:fx=&quot;http://javafx.com/fxml/1&quot;&#10;            fx:controller=&quot;Controllers.ChatbotController&quot;&#10;            prefWidth=&quot;420.0&quot; prefHeight=&quot;520.0&quot;&#10;            style=&quot;-fx-background-color: #f7f9f4;&quot;&gt;&#10;&#10;    &lt;top&gt;&#10;        &lt;HBox spacing=&quot;8&quot;&#10;              style=&quot;-fx-background-color: white;&#10;                     -fx-padding: 12 16 12 16;&#10;                     -fx-border-color: #e5e7eb;&#10;                     -fx-border-width: 0 0 1 0;&quot;&gt;&#10;            &lt;children&gt;&#10;                &lt;Label text=&quot;&quot;&#10;                       style=&quot;-fx-font-size: 20px;&quot;/&gt;&#10;                &lt;VBox spacing=&quot;2&quot;&gt;&#10;                    &lt;children&gt;&#10;                        &lt;Label text=&quot;Assistant AGRIGO&quot;&#10;                               style=&quot;-fx-font-size: 15px;&#10;                                      -fx-font-weight: bold;&#10;                                      -fx-text-fill: #1a3318;&quot;/&gt;&#10;                        &lt;Label text=&quot;Posez vos questions sur les tâches, parcelles, irrigation, etc.&quot;&#10;                               wrapText=&quot;true&quot;&#10;                               style=&quot;-fx-font-size: 11px;&#10;                                      -fx-text-fill: #6b7280;&quot;/&gt;&#10;                    &lt;/children&gt;&#10;                &lt;/VBox&gt;&#10;                &lt;Region HBox.hgrow=&quot;ALWAYS&quot;/&gt;&#10;            &lt;/children&gt;&#10;        &lt;/HBox&gt;&#10;    &lt;/top&gt;&#10;&#10;    &lt;center&gt;&#10;        &lt;ScrollPane fx:id=&quot;scrollPane&quot;&#10;                    hbarPolicy=&quot;NEVER&quot; vbarPolicy=&quot;AS_NEEDED&quot;&#10;                    fitToWidth=&quot;true&quot;&#10;                    style=&quot;-fx-background-color: transparent; -fx-padding: 8 12 8 12;&quot;&gt;&#10;            &lt;content&gt;&#10;                &lt;VBox fx:id=&quot;messagesContainer&quot;&#10;                      spacing=&quot;8&quot;&#10;                      style=&quot;-fx-background-color: transparent;&quot;&#10;                      prefWidth=&quot;380.0&quot;&gt;&#10;                    &lt;children&gt;&#10;                        &lt;Label text=&quot;Bonjour , je suis l’assistant AGRIGO.\nExpliquez-moi simplement votre question (ex : irrigation, tâches, récoltes, erreurs sur la plateforme) et je vous guiderai étape par étape.&quot;&#10;                               wrapText=&quot;true&quot;&#10;                               style=&quot;-fx-background-color: white;&#10;                                      -fx-background-radius: 10;&#10;                                      -fx-padding: 10 12 10 12;&#10;                                      -fx-text-fill: #1f2933;&#10;                                      -fx-font-size: 12px;&#10;                                      -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.04), 6, 0, 0, 1);&quot;/&gt;&#10;                    &lt;/children&gt;&#10;                &lt;/VBox&gt;&#10;            &lt;/content&gt;&#10;        &lt;/ScrollPane&gt;&#10;    &lt;/center&gt;&#10;&#10;    &lt;bottom&gt;&#10;        &lt;VBox spacing=&quot;6&quot;&#10;              style=&quot;-fx-padding: 8 12 12 12;&#10;                     -fx-background-color: #f7f9f4;&#10;                     -fx-border-color: #e5e7eb;&#10;                     -fx-border-width: 1 0 0 0;&quot;&gt;&#10;            &lt;children&gt;&#10;                &lt;TextArea fx:id=&quot;inputField&quot;&#10;                          promptText=&quot;Décrivez votre question ou problème…&quot;&#10;                          prefRowCount=&quot;2&quot;&#10;                          wrapText=&quot;true&quot;&#10;                          style=&quot;-fx-font-size: 12px;&#10;                                 -fx-background-radius: 8;&#10;                                 -fx-border-radius: 8;&#10;                                 -fx-border-color: #d1d5db;&#10;                                 -fx-text-fill: #111827;&quot;/&gt;&#10;                &lt;HBox alignment=&quot;CENTER_RIGHT&quot; spacing=&quot;8&quot;&gt;&#10;                    &lt;children&gt;&#10;                        &lt;Label text=&quot;Réponses automatisées simples. Pour les cas complexes, contactez le support.&quot;&#10;                               wrapText=&quot;true&quot;&#10;                               style=&quot;-fx-font-size: 9px; -fx-text-fill: #9ca3af;&quot;&#10;                               HBox.hgrow=&quot;ALWAYS&quot;/&gt;&#10;                        &lt;Button text=&quot;Envoyer&quot;&#10;                                onAction=&quot;#handleSend&quot;&#10;                                prefHeight=&quot;30&quot;&#10;                                style=&quot;-fx-background-color: #228B22;&#10;                                       -fx-background-radius: 8;&#10;                                       -fx-text-fill: white;&#10;                                       -fx-font-size: 12px;&#10;                                       -fx-font-weight: 600;&#10;                                       -fx-cursor: hand;&#10;                                       -fx-padding: 4 14 4 14;&quot;/&gt;&#10;                    &lt;/children&gt;&#10;                &lt;/HBox&gt;&#10;            &lt;/children&gt;&#10;        &lt;/VBox&gt;&#10;    &lt;/bottom&gt;&#10;&#10;&lt;/BorderPane&gt;&#10;&#10;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&#10;&lt;?import javafx.geometry.Insets?&gt;&#10;&lt;?import javafx.scene.control.Button?&gt;&#10;&lt;?import javafx.scene.control.Label?&gt;&#10;&lt;?import javafx.scene.control.ScrollPane?&gt;&#10;&lt;?import javafx.scene.control.TextArea?&gt;&#10;&lt;?import javafx.scene.layout.BorderPane?&gt;&#10;&lt;?import javafx.scene.layout.HBox?&gt;&#10;&lt;?import javafx.scene.layout.Priority?&gt;&#10;&lt;?import javafx.scene.layout.Region?&gt;&#10;&lt;?import javafx.scene.layout.VBox?&gt;&#10;&#10;&lt;BorderPane xmlns=&quot;http://javafx.com/javafx/21&quot;&#10;            xmlns:fx=&quot;http://javafx.com/fxml/1&quot;&#10;            fx:controller=&quot;Controllers.ChatbotController&quot;&#10;            prefWidth=&quot;420.0&quot; prefHeight=&quot;520.0&quot;&#10;            style=&quot;-fx-background-color: #f7f9f4;&quot;&gt;&#10;&#10;    &lt;!-- Stylesheet chargée dynamiquement depuis le contrôleur --&gt;&#10;&#10;    &lt;top&gt;&#10;        &lt;HBox spacing=&quot;8&quot;&#10;              style=&quot;-fx-background-color: white;&#10;                     -fx-padding: 12 16 12 16;&#10;                     -fx-border-color: #e5e7eb;&#10;                     -fx-border-width: 0 0 1 0;&quot;&gt;&#10;            &lt;children&gt;&#10;                &lt;Label text=&quot;&quot;&#10;                       style=&quot;-fx-font-size: 20px;&quot;/&gt;&#10;                &lt;VBox spacing=&quot;2&quot;&gt;&#10;                    &lt;children&gt;&#10;                        &lt;Label text=&quot;Assistant AGRIGO&quot;&#10;                               style=&quot;-fx-font-size: 15px;&#10;                                      -fx-font-weight: bold;&#10;                                      -fx-text-fill: #1a3318;&quot;/&gt;&#10;                        &lt;Label text=&quot;Posez vos questions sur les tâches, parcelles, irrigation, etc.&quot;&#10;                               wrapText=&quot;true&quot;&#10;                               style=&quot;-fx-font-size: 11px;&#10;                                      -fx-text-fill: #6b7280;&quot;/&gt;&#10;                    &lt;/children&gt;&#10;                &lt;/VBox&gt;&#10;                &lt;Region HBox.hgrow=&quot;ALWAYS&quot;/&gt;&#10;            &lt;/children&gt;&#10;        &lt;/HBox&gt;&#10;    &lt;/top&gt;&#10;&#10;    &lt;center&gt;&#10;        &lt;ScrollPane fx:id=&quot;scrollPane&quot;&#10;                    hbarPolicy=&quot;NEVER&quot; vbarPolicy=&quot;AS_NEEDED&quot;&#10;                    fitToWidth=&quot;true&quot;&#10;                    style=&quot;-fx-background-color: transparent; -fx-padding: 8 12 8 12;&quot;&gt;&#10;            &lt;content&gt;&#10;                &lt;VBox fx:id=&quot;messagesContainer&quot;&#10;                      spacing=&quot;8&quot;&#10;                      style=&quot;-fx-background-color: transparent;&quot;&#10;                      prefWidth=&quot;380.0&quot;&gt;&#10;                    &lt;children&gt;&#10;                        &lt;Label text=&quot;Bonjour , je suis l’assistant AGRIGO.\nExpliquez-moi simplement votre question (ex : irrigation, tâches, récoltes, erreurs sur la plateforme) et je vous guiderai étape par étape.&quot;&#10;                               wrapText=&quot;true&quot;&#10;                               style=&quot;-fx-background-color: white;&#10;                                      -fx-background-radius: 10;&#10;                                      -fx-padding: 10 12 10 12;&#10;                                      -fx-text-fill: #1f2933;&#10;                                      -fx-font-size: 12px;&#10;                                      -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.04), 6, 0, 0, 1);&quot;/&gt;&#10;                    &lt;/children&gt;&#10;                &lt;/VBox&gt;&#10;            &lt;/content&gt;&#10;        &lt;/ScrollPane&gt;&#10;    &lt;/center&gt;&#10;&#10;    &lt;bottom&gt;&#10;        &lt;VBox spacing=&quot;6&quot;&#10;              style=&quot;-fx-padding: 8 12 12 12;&#10;                     -fx-background-color: #f7f9f4;&#10;                     -fx-border-color: #e5e7eb;&#10;                     -fx-border-width: 1 0 0 0;&quot;&gt;&#10;            &lt;children&gt;&#10;                &lt;TextArea fx:id=&quot;inputField&quot;&#10;                          promptText=&quot;Décrivez votre question ou problème…&quot;&#10;                          prefRowCount=&quot;2&quot;&#10;                          wrapText=&quot;true&quot;&#10;                          style=&quot;-fx-font-size: 12px;&#10;                                 -fx-background-radius: 8;&#10;                                 -fx-border-radius: 8;&#10;                                 -fx-border-color: #d1d5db;&#10;                                 -fx-text-fill: #111827;&quot;/&gt;&#10;                &lt;HBox alignment=&quot;CENTER_RIGHT&quot; spacing=&quot;8&quot;&gt;&#10;                    &lt;children&gt;&#10;                        &lt;Label text=&quot;Réponses automatisées simples. Pour les cas complexes, contactez le support.&quot;&#10;                               wrapText=&quot;true&quot;&#10;                               style=&quot;-fx-font-size: 9px; -fx-text-fill: #9ca3af;&quot;&#10;                               HBox.hgrow=&quot;ALWAYS&quot;/&gt;&#10;                        &lt;Button text=&quot;Envoyer&quot;&#10;                                onAction=&quot;#handleSend&quot;&#10;                                prefHeight=&quot;30&quot;&#10;                                style=&quot;-fx-background-color: #228B22;&#10;                                       -fx-background-radius: 8;&#10;                                       -fx-text-fill: white;&#10;                                       -fx-font-size: 12px;&#10;                                       -fx-font-weight: 600;&#10;                                       -fx-cursor: hand;&#10;                                       -fx-padding: 4 14 4 14;&quot;/&gt;&#10;                    &lt;/children&gt;&#10;                &lt;/HBox&gt;&#10;            &lt;/children&gt;&#10;        &lt;/VBox&gt;&#10;    &lt;/bottom&gt;&#10;&#10;&lt;/BorderPane&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/resources/css/chatbot.css">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/resources/css/chatbot.css" />
              <option name="updatedContent" value="/* Styles pour le Chatbot AGRIGO */&#10;.root.chat-root {&#10;    -fx-font-family: &quot;Segoe UI&quot;, Arial, sans-serif;&#10;}&#10;&#10;.chat-header {&#10;    -fx-background-color: white;&#10;    -fx-padding: 12 16 12 16;&#10;    -fx-border-color: #e5e7eb;&#10;    -fx-border-width: 0 0 1 0;&#10;}&#10;&#10;.messages-panel {&#10;    -fx-background-color: transparent;&#10;    -fx-padding: 12;&#10;}&#10;&#10;.messages-container {&#10;    -fx-spacing: 10;&#10;    -fx-padding: 8;&#10;}&#10;&#10;.message {&#10;    -fx-max-width: 78%;&#10;    -fx-wrap-text: true;&#10;}&#10;&#10;.message.bot {&#10;    -fx-background-color: white;&#10;    -fx-background-radius: 12;&#10;    -fx-padding: 10 12 10 12;&#10;    -fx-text-fill: #111827;&#10;    -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.06), 6, 0, 0, 1);&#10;}&#10;&#10;.message.user {&#10;    -fx-background-color: #22c55e;&#10;    -fx-background-radius: 12;&#10;    -fx-padding: 10 12 10 12;&#10;    -fx-text-fill: white;&#10;}&#10;&#10;.hbox-user {&#10;    -fx-alignment: center-right;&#10;}&#10;&#10;.hbox-bot {&#10;    -fx-alignment: center-left;&#10;}&#10;&#10;.avatar {&#10;    -fx-min-width: 36px;&#10;    -fx-min-height: 36px;&#10;    -fx-max-width: 36px;&#10;    -fx-max-height: 36px;&#10;    -fx-background-radius: 18px;&#10;    -fx-alignment: center;&#10;    -fx-font-size: 16px;&#10;}&#10;&#10;.avatar.bot {&#10;    -fx-background-color: #efefef;&#10;    -fx-text-fill: #166534;&#10;}&#10;&#10;.avatar.user {&#10;    -fx-background-color: #14532d;&#10;    -fx-text-fill: white;&#10;}&#10;&#10;.send-button {&#10;    -fx-background-color: #228B22;&#10;    -fx-background-radius: 8;&#10;    -fx-text-fill: white;&#10;    -fx-font-size: 12px;&#10;    -fx-font-weight: 600;&#10;}&#10;&#10;.send-button:hover {&#10;    -fx-opacity: 0.9;&#10;}&#10;&#10;.input-area {&#10;    -fx-font-size: 12px;&#10;    -fx-background-radius: 8;&#10;    -fx-border-radius: 8;&#10;    -fx-border-color: #d1d5db;&#10;    -fx-text-fill: #111827;&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>